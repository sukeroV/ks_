@startuml 用户认证流程

!theme plain
skinparam backgroundColor white
skinparam sequenceMessageAlign center

actor "用户" as user
participant "Vue App" as app
participant "Router" as router
participant "Axios" as axios
participant "Flask Server" as server
participant "User Model" as user_model
database "MySQL" as db

== 登录流程 ==
user -> app: 输入用户名密码
activate app
app -> axios: POST /api/login
activate axios
axios -> server: 发送登录请求
activate server
server -> user_model: 查询用户
activate user_model
user_model -> db: SELECT * FROM users
db --> user_model: 用户数据
user_model -> user_model: 验证密码
user_model --> server: 验证结果
deactivate user_model

alt 验证成功
    server --> axios: 返回用户信息
    axios --> app: 登录成功
    app -> localStorage: 保存用户信息
    app -> router: 导航到主页
    app --> user: 显示登录成功
else 验证失败
    server --> axios: 返回错误信息
    axios --> app: 登录失败
    app --> user: 显示错误信息
end
deactivate server
deactivate axios
deactivate app

== 路由验证流程 ==
router -> localStorage: 检查用户信息
activate router
alt 用户已登录
    router -> router: 允许访问
else 用户未登录
    router -> router: 重定向到登录页
end
deactivate router

== 登出流程 ==
user -> app: 点击登出
activate app
app -> localStorage: 清除用户信息
app -> router: 导航到登录页
app --> user: 显示登出成功
deactivate app

@enduml 