@startuml 口算练习系统数据库设计

!theme plain
skinparam backgroundColor white
skinparam linetype ortho

' 用户表
entity "用户表(user)" as user {
  * user_id : VARCHAR(15) <<PK>> // 用户ID
  --
  * name : VARCHAR(50) // 用户姓名
  * id_card : VARCHAR(18) // 身份证号
  * grade : INTEGER // 年级
  * password : VARCHAR(512) // 加密密码
  phone : VARCHAR(11) // 电话号码
}

' 习题集表
entity "习题集表(exercise_set)" as exercise_set {
  * exercise_set_id : INTEGER <<PK>> // 习题集ID
  --
  * user_id : VARCHAR(15) <<FK>> // 创建者ID
  * total_expressions : INTEGER // 总题目数
  * bracket_expressions : INTEGER // 括号题目数
  * time_limit : INTEGER // 时间限制(分钟)
  * create_time : DATETIME // 创建时间
  * operators : VARCHAR(1000) // 运算符列表
  * operator_count : INTEGER // 运算符数量
  * min_number : INTEGER // 最小值
  * max_number : INTEGER // 最大值
}

' 算式表
entity "算式表(expression)" as expression {
  * expression_id : INTEGER <<PK>> // 算式ID
  --
  * exercise_set_id : INTEGER <<FK>> // 所属习题集ID
  * expression_text : VARCHAR(100) // 算式表达式
  * has_brackets : BOOLEAN // 是否含括号
  * operator_count : INTEGER // 运算符数量
  * answer : FLOAT // 正确答案
}

' 练习记录表
entity "练习记录表(practice_record)" as practice_record {
  * record_id : INTEGER <<PK>> // 记录ID
  --
  * user_id : VARCHAR(50) <<FK>> // 用户ID
  * exercise_set_id : INTEGER <<FK>> // 习题集ID
  * completion_time : DATETIME // 完成时间
  duration : INTEGER // 练习时长(秒)
  is_timeout : BOOLEAN // 是否超时
  is_completed : BOOLEAN // 是否完成
  * total_expressions : INTEGER // 总题目数
  * bracket_expressions : INTEGER // 括号题目数
  * time_limit : INTEGER // 时间限制
  * operators : VARCHAR(50) // 运算符列表
  * operator_count : INTEGER // 运算符数量
  * min_number : INTEGER // 最小值
  * max_number : INTEGER // 最大值
}

' 答题记录表
entity "答题记录表(answer_record)" as answer_record {
  * answer_record_id : INTEGER <<PK>> // 答题记录ID
  --
  * expression_id : INTEGER <<FK>> // 算式ID
  * user_answer : FLOAT // 用户答案
  * is_correct : BOOLEAN // 是否正确
  * answer_time : FLOAT // 答题时间(秒)
}

' 错题记录表
entity "错题记录表(error_record)" as error_record {
  * error_record_id : INTEGER <<PK>> // 错题记录ID
  --
  * answer_record_id : INTEGER <<FK>> // 答题记录ID
  is_exported : BOOLEAN // 是否已导出
  export_time : DATETIME // 导出时间
}

' 定义关系
user ||--o{ exercise_set : "创建习题集"
user ||--o{ practice_record : "进行练习"

exercise_set ||--o{ expression : "包含算式"
exercise_set ||--o{ practice_record : "被练习"

expression ||--o{ answer_record : "被答题"

answer_record ||--o{ error_record : "记录错题"

' 添加说明
note right of user
  用户说明:
  - 存储用户基本信息
  - 密码经过加密存储
  - 支持密码验证
end note

note right of exercise_set
  习题集说明:
  - 支持括号运算
  - 可设置时间限制
  - 可配置运算符
  - 可设置数值范围
end note

note bottom of practice_record
  练习记录说明:
  - 记录练习过程
  - 统计练习时间
  - 记录完成情况
  - 保存练习参数
end note

@enduml 